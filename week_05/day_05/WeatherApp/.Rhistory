"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = col_names)
header <- extract_header(lerwickdata.txt)
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = col_names)
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
workdir=getwd()
extract_header <- function(filename){
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header+txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header <- extract_header("lerwickdata.txt")
filename = "lerwickdata.txt"
filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header+txt[2], "Lon\\s.{6}") #identify lon string
filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header+txt[2], "Lon\\s.{6}") #identify lon string
filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = col_names)
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = col_names)
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = col_names)
header <- extract_header("lerwickdata.txt")
View(header)
View(header)
header <- extract_header("lerwickdata.txt")
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
header <- extract_header("lerwickdata.txt")
header <- extract_header("lerwickdata.txt")
data <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
View(data)
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
workdir=getwd()
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data=left_join(data1,data2)
View(data3)
View(data3)
data=left_join(data1,data2)
View(data1)
View(data1)
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("*","#")
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("*","#"))
strip_strings <- function(old_column, strings){
cleaned <- old_column
# order strings longest first so "string within string" is not a problem
order <- sort(nchar(strings), decreasing=TRUE, index.return=TRUE)
strings <- strings[order$ix]
for (badstring in strings){
cleaned <- str_remove(cleaned,str_c(" ",badstring))
#adding this doesnt allow for a string to be 'embedded'
cleaned <- str_trim(cleaned)
}
return(cleaned)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("*","#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("\\*","\\#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("\\*","\\#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- strip_strings(data1,c("\\*","\\#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
clean_data1 <- strip_strings(data1,c("\\*","\\#"))
View(data1)
clean_data1 <- strip_strings(data1,c("\\*","\\#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$sun <- strip_strings(data1$sun,c("\\*","\\#"))
View(data1)
View(data1)
glimpse(data1)
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$rain <- as.double(data1$rain)
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$rain <- as.double(data1$rain)
data1$sun <- strip_strings(data1$sun,c("\\*","\\#"))
data1$sun <- as.double(data1$sun)
glmpse(data1$sun)
glimpse(data1$sun)
glimpse(data1)
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
strip_strings <- function(old_column, strings){
cleaned <- old_column
# order strings longest first so "string within string" is not a problem
order <- sort(nchar(strings), decreasing=TRUE, index.return=TRUE)
strings <- strings[order$ix]
for (badstring in strings){
cleaned <- str_remove(cleaned,str_c(" ",badstring))
#adding this doesnt allow for a string to be 'embedded'
cleaned <- str_trim(cleaned)
}
return(cleaned)
}
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$rain <- as.double(data1$rain)
data1$sun <- strip_strings(data1$sun,c("\\*","\\#"))
data1$sun <- as.double(data1$sun)
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data2$rain <- strip_strings(data2$rain,c("\\*","\\#"))
data2$rain <- as.double(data2$rain)
data2$sun <- strip_strings(data2$sun,c("\\*","\\#"))
data2$sun <- as.double(data2$sun)
glimpse(paisleydata)
glimpse(data2)
data2 %>%
mutate(across(everything(),strip_strings(x.,c("\\*","\\#"))))
data2 %>%
mutate(across(everything(),strip_strings(.x,c("\\*","\\#"))))
data2 %>%
mutate(across(everything(),~strip_strings(x.,c("\\*","\\#"))))
data2 %>%
mutate(across(everything(),~strip_strings{(x.,c("\\*","\\#"))}))
pattern=c("\\*","\\#")
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data2 %>%
mutate(across(everything(),~strip_strings(x.,pattern)))
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data2 %>%
mutate(across(everything(),~{strip_strings(x.,pattern)}))
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data2 %>%
mutate(across(everything(),~{strip_strings(x.,pattern)}))
glimpse(data1)
is.character(cols())
is.character(data1$cols())
is.character(data2$cols())
is.character(data2$colnames())
is.character(data2$colnames
is.character(data2$colnames)
is.character(data2$cols)
is.character(data2)
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data2 %>%
mutate(across(is.character,~{strip_strings(x.,pattern)}))
glimpse(data2)
data2$tmax <- strip_strings(data2$tmax,c("\\*","\\#"))
data2$tmax <- as.double(data2$tmax)
data2$tmin <- strip_strings(data2$tmin,c("\\*","\\#"))
data2$tmin <- as.double(data2$tmin)
glimpse(data3)
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data3 %>%
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data3$tmax <- strip_strings(data3$tmax,c("\\*","\\#"))
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data3$tmax <- strip_strings(data3$tmax,c("\\*","\\#"))
data3$tmax <- as.double(data3$tmax)
data3$tmin <- strip_strings(data3$tmin,c("\\*","\\#"))
data3$tmin <- as.double(data3$tmin)
data3$af <- strip_strings(data3$af,c("\\*","\\#"))
data3$af <- as.double(data3$af)
data3$rain <- strip_strings(data3$rain,c("\\*","\\#"))
data3$rain <- as.double(data3$rain)
data3$sun <- strip_strings(data3$sun,c("\\*","\\#"))
data3$sun <- as.double(data3$sun)
## merge all files together
```{r}
data=left_join(data1,data2)
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
pattern=c("\\*","\\#")
data2 %>%
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data2$tmax <- strip_strings(data2$tmax,c("\\*","\\#"))
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data2$tmax <- strip_strings(data2$tmax,c("\\*","\\#"))
data2$tmax <- as.double(data2$tmax)
data2$tmin <- strip_strings(data2$tmin,c("\\*","\\#"))
data2$tmin <- as.double(data2$tmin)
data2$af <- strip_strings(data2$af,c("\\*","\\#"))
data2$af <- as.double(data2$af)
data2$rain <- strip_strings(data2$rain,c("\\*","\\#"))
data2$rain <- as.double(data2$rain)
data2$sun <- strip_strings(data2$sun,c("\\*","\\#"))
data2$sun <- as.double(data2$sun)
data=left_join(data1,data2)
data=left_join(data1,data2)
data=left_join(data,data3)
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data3 <- mutate(data3,location = header3$location)
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data3$tmax <- strip_strings(data3$tmax,c("\\*","\\#"))
data3$tmax <- as.double(data3$tmax)
data3$tmin <- strip_strings(data3$tmin,c("\\*","\\#"))
data3$tmin <- as.double(data3$tmin)
data3$af <- strip_strings(data3$af,c("\\*","\\#"))
data3$af <- as.double(data3$af)
data3$rain <- strip_strings(data3$rain,c("\\*","\\#"))
data3$rain <- as.double(data3$rain)
data3$sun <- strip_strings(data3$sun,c("\\*","\\#"))
data3$sun <- as.double(data3$sun)
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- mutate(data2,location = header1$location)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$rain <- as.double(data1$rain)
data1$sun <- strip_strings(data1$sun,c("\\*","\\#"))
data1$sun <- as.double(data1$sun)
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
strip_strings <- function(old_column, strings){
cleaned <- old_column
# order strings longest first so "string within string" is not a problem
order <- sort(nchar(strings), decreasing=TRUE, index.return=TRUE)
strings <- strings[order$ix]
for (badstring in strings){
cleaned <- str_remove(cleaned,str_c(" ",badstring))
#adding this doesnt allow for a string to be 'embedded'
cleaned <- str_trim(cleaned)
}
return(cleaned)
}
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data1 <- mutate(data2,location = header1$location)
data1$rain <- strip_strings(data1$rain,c("\\*","\\#"))
data1$rain <- as.double(data1$rain)
data1$sun <- strip_strings(data1$sun,c("\\*","\\#"))
data1$sun <- as.double(data1$sun)
header2 <- extract_header("paisleydata.txt")
data2 <- read.table(here::here("raw_data","paisleydata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data2 <- mutate(data2,location = header2$location)
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data2$tmax <- strip_strings(data2$tmax,c("\\*","\\#"))
data2$tmax <- as.double(data2$tmax)
data2$tmin <- strip_strings(data2$tmin,c("\\*","\\#"))
data2$tmin <- as.double(data2$tmin)
data2$af <- strip_strings(data2$af,c("\\*","\\#"))
data2$af <- as.double(data2$af)
data2$rain <- strip_strings(data2$rain,c("\\*","\\#"))
data2$rain <- as.double(data2$rain)
data2$sun <- strip_strings(data2$sun,c("\\*","\\#"))
data2$sun <- as.double(data2$sun)
header3 <- extract_header("eastbournedata.txt")
data3 <- read.table(here::here("raw_data","eastbournedata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
data3 <- mutate(data3,location = header3$location)
# need to get mutate cross to work on this!!
#mutate(across(is.character,~{strip_strings(x.,pattern)}))
data3$tmax <- strip_strings(data3$tmax,c("\\*","\\#"))
data3$tmax <- as.double(data3$tmax)
data3$tmin <- strip_strings(data3$tmin,c("\\*","\\#"))
data3$tmin <- as.double(data3$tmin)
data3$af <- strip_strings(data3$af,c("\\*","\\#"))
data3$af <- as.double(data3$af)
data3$rain <- strip_strings(data3$rain,c("\\*","\\#"))
data3$rain <- as.double(data3$rain)
data3$sun <- strip_strings(data3$sun,c("\\*","\\#"))
data3$sun <- as.double(data3$sun)
data=left_join(data1,data2)
data=left_join(data,data3)
# calculate long term averages
data1_avg <- data1 %>%
filter(yyyy %in% c(1991:2020)) %>%
group_by (mm) %>%
summarise(across(everything(),
~{mean(.x, na.rm = TRUE)})) %>%
# calculate long term averages
data1_avg <- data1 %>%
filter(yyyy %in% c(1991:2020)) %>%
group_by (mm) %>%
summarise(across(everything(),
~{mean(.x, na.rm = TRUE)})) %>%
# calculate long term averages
data1_avg <- data1 %>%
filter(yyyy %in% c(1991:2020)) %>%
group_by (mm) %>%
summarise(across(everything(),
~{mean(.x, na.rm = TRUE)}))
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
strip_strings <- function(old_column, strings){
cleaned <- old_column
# order strings longest first so "string within string" is not a problem
order <- sort(nchar(strings), decreasing=TRUE, index.return=TRUE)
strings <- strings[order$ix]
for (badstring in strings){
cleaned <- str_remove(cleaned,str_c(" ",badstring))
#adding this doesnt allow for a string to be 'embedded'
cleaned <- str_trim(cleaned)
}
return(cleaned)
}
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
library(tidyverse)
library(janitor)
library(colorfindr)
library(lubridate)
strip_strings <- function(old_column, strings){
cleaned <- old_column
# order strings longest first so "string within string" is not a problem
order <- sort(nchar(strings), decreasing=TRUE, index.return=TRUE)
strings <- strings[order$ix]
for (badstring in strings){
cleaned <- str_remove(cleaned,str_c(" ",badstring))
#adding this doesnt allow for a string to be 'embedded'
cleaned <- str_trim(cleaned)
}
return(cleaned)
}
extract_header <- function(filename){
#filename <-  "lerwickdata.txt"
header_txt <- read_lines(here::here("raw_data",filename),n_max = 7)
location_txt <- header_txt[1]
position_lat <- str_extract(header_txt[2], "Lat\\s.{6}") #identify lat string
position_lat <- as.numeric(str_remove(position_lat,"Lat ")) #strip lat string
position_lon <- str_extract(header_txt[2], "Lon\\s.{6}") #identify lon string
position_lon <- as.numeric(str_remove(position_lon,"Lon ")) #strip lon string
col_txt <- str_split(header_txt[6], pattern = "\\s{1,}", simplify = TRUE)
col_txt <- col_txt[2:8]
param_txt <- str_split(header_txt[7], pattern = "\\s{1,}", simplify = TRUE)
param_txt <- param_txt[2:5]
header <- list("location" = location_txt,
"param_names" = param_txt,
"col_names" = col_txt,
"latitude" = position_lat,
"longitude" = position_lon)
}
header1 <- extract_header("lerwickdata.txt")
data1 <- read.table(here::here("raw_data","lerwickdata.txt"), header = FALSE, skip = 7, comment.char = "P", fill = TRUE, flush = TRUE, col.names = header$col_names)
